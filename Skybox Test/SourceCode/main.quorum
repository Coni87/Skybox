use Libraries.Game.Game
use Libraries.Game.Graphics.Skybox
use Libraries.Game.Graphics.Camera
use Libraries.Game.InputMonitor
use Libraries.Interface.Events.KeyboardEvent
use Libraries.Game.Graphics.Model
use Libraries.Game.Graphics.Color
use Libraries.Compute.Vector3

class Main is Game
    Skybox skybox
    Camera camera = undefined
    InputMonitor im
    KeyboardEvent button
    number x = 0
    number y = 0
    number z = 0

    Model table
    Model leg1
    Model leg2
    Model leg3
    Model leg4
    Color wood
        

    action Main
        StartGame()
    end

    action CreateGame
        skybox:Load("iceflow_rt.png", "iceflow_lf.png", "iceflow_up.png", "iceflow_dn.png", "iceflow_ft.png", "iceflow_bk.png")
        SetSkybox(skybox)
        camera = GetCamera3D()
        camera:SetPosition(0, 0, 0)
        camera:LookAt(0, 0, 1)
        
        wood:SetColor(0.55, 0.40, 0.30, 1)
        
        table:LoadBox(15, 1, 15, wood)
        leg1:LoadCylinder(1, 15, 1, wood)
        leg2:LoadCylinder(1, 15, 1, wood)
        leg3:LoadCylinder(1, 15, 1, wood)
        leg4:LoadCylinder(1, 15, 1, wood)
        leg1:SetPosition(7, -7.5, 7)
        leg2:SetPosition(-7, -7.5, 7)
        leg3:SetPosition(7, -7.5, -7)
        leg4:SetPosition(-7, -7.5, -7)
        table:Add(leg1)
        table:Add(leg2)
        table:Add(leg3)
        table:Add(leg4)
        table:SetPosition(250,-10,150)
        Add(table)
    end


    action Update(number seconds)
        if im:IsKeyPressed(button:RIGHT)
            x = x + 25 * seconds
            camera:SetYawPitchRoll(x,y,z)
        
        
        elseif im:IsKeyPressed(button:LEFT)
            x = x - 25 * seconds
            camera:SetYawPitchRoll(x,y,z)
        
        elseif im:IsKeyPressed(button:UP)
            y = y + 25 * seconds
            camera:SetYawPitchRoll(x,y,z)
            if y > 90
                y = 90
            end

        elseif im:IsKeyPressed(button:DOWN)
            y = y - 25 * seconds
            camera:SetYawPitchRoll(x,y,z)
            if y < 0
                y = 0
            end
        end
        
        if im:IsKeyPressed(button:W)
            camera:LookAt(table:GetPosition())
            if im:IsKeyPressed(button:R)
                Vector3 direction
                direction = camera:GetDirection():Copy()
                direction:Scale(25 * seconds)
                camera:Move(direction)
                output x
                x = 47
                y = 0
                z= 0
                camera:SetYawPitchRoll(x,y,z)
            end
        end

        if im:IsKeyPressed(button:X)
            Exit()
        end
    end
end
